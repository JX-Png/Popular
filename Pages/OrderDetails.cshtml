@page
@model PopularBookstore.Pages.OrderDetailsModel
@{
    ViewData["Title"] = "Order Details";
}

<partial name="_Header" />

<style>
    .order-details-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
    }

    .order-details-header {
        margin-bottom: 20px;
    }

    .order-info {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
    }

    .order-info-item {
        flex: 1;
    }

    .order-status {
        font-weight: bold;
        color: #d35400;
    }

    .status-completed {
        color: #27ae60;
    }

    .status-processing {
        color: #3498db;
    }

    .status-shipping {
        color: #f39c12;
    }

    .order-items {
        border: 2px solid #ffe0e0;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        background-color: #fff9f9;
    }

    .order-item {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
    }

        .order-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

    .item-image {
        width: 60px;
        height: 80px;
        margin-right: 15px;
    }

        .item-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

    .item-details {
        flex-grow: 1;
    }

    .item-title {
        font-weight: bold;
        margin-bottom: 5px;
    }

    .item-author {
        color: #666;
        font-size: 0.9em;
        margin-bottom: 5px;
    }

    .item-price {
        text-align: right;
        min-width: 80px;
    }

    .order-summary {
        text-align: right;
        margin-top: 20px;
    }

    .order-total {
        font-size: 1.2em;
        font-weight: bold;
    }

    .back-link {
        margin-top: 20px;
        display: inline-block;
    }
</style>

<div class="order-details-container">
    <div class="order-details-header">
        <h2>Order #@Model.Order.Id</h2>
        <div class="order-info">
            <div class="order-info-item">
                <div class="order-status @("status-" + Model.Order.Status.ToLower())">
                    Status: @Model.Order.Status
                </div>
                <div>
                    Ordered on: @Model.Order.OrderDate.ToString("MM/dd/yyyy")
                </div>
            </div>
        </div>
    </div>

    <div class="order-items">
        <h3>Order Items</h3>
        @foreach (var item in Model.Order.OrderItems)
        {
            <div class="order-item">
                <div class="item-image">
                    @if (item.Book.ImageData != null && item.Book.ImageMimeType != null)
                    {
                        <img src="data:@item.Book.ImageMimeType;base64,@Convert.ToBase64String(item.Book.ImageData)" alt="@item.Book.Title" />
                    }
                    else if (!string.IsNullOrEmpty(item.Book.ImageUrl))
                    {
                        <img src="@item.Book.ImageUrl" alt="@item.Book.Title" />
                    }
                    else
                    {
                        <span>📖</span>
                    }
                </div>
                <div class="item-details">
                    <div class="item-title">@item.Book.Title</div>
                    <div class="item-author">by @item.Book.Author</div>
                    <div>Qty: @item.Quantity</div>
                </div>
                <div class="item-price">
                    @((item.Price * item.Quantity).ToString("C"))
                </div>
            </div>
        }

        <div class="order-summary">
            <div class="order-total">
                Total: @Model.Order.TotalAmount.ToString("C")
            </div>
        </div>
    </div>

    <a asp-page="/OrderHistory" class="back-link">&larr; Back to Order History</a>
</div>